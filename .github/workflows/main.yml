name: VPS
on:
  workflow_dispatch:

jobs:
  secure-vps:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # Ÿäÿ®ŸÇŸâ ÿ¥ÿ∫ÿßŸÑ 6 ÿ≥ÿßÿπÿßÿ™
    steps:
      - name: Install & Configure SSH
        run: |
          sudo apt update -y
          sudo apt install -y openssh-server unzip curl -y
          sudo systemctl enable ssh
          sudo systemctl start ssh
          echo "root:admin@123" | sudo chpasswd
          echo "PermitRootLogin yes" | sudo tee -a /etc/ssh/sshd_config
          sudo service ssh restart
          echo "‚úÖ SSH configured: user=root | pass=admin@123"

      - name: Install Ngrok
        run: |
          curl -s https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-stable-linux-amd64.zip -o ngrok.zip
          unzip ngrok.zip
          sudo mv ngrok /usr/local/bin/ngrok
          ngrok config add-authtoken ${{ secrets.NGROK_AUTH_TOKEN }}
          echo "‚úÖ Ngrok installed successfully"

      - name: Start Ngrok Tunnel
        run: |
          nohup ngrok tcp 22 --region eu > ngrok.log 2>&1 &
          sleep 5
          NGROK_URL=$(curl -s http://127.0.0.1:4040/api/tunnels | grep -o 'tcp://[0-9a-zA-Z\.:]*')
          echo "NGROK_URL=$NGROK_URL" >> $GITHUB_ENV
          echo "‚úÖ Ngrok Tunnel started: $NGROK_URL"

      - name: Show Connection Info
        run: |
          echo "------------------------------------"
          echo "‚úÖ VPS is Ready!"
          echo "üåç Connect via:"
          echo "SSH Command:"
          echo "ssh root@${NGROK_URL#tcp://}"
          echo "üîë Password: admin@123"
          echo "------------------------------------"

      - name: Keep VPS Alive
        run: |
          while true; do
            echo "[$(date)] VPS running..."
            sleep 300
          done
